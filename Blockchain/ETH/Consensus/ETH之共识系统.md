在所有这些昂贵的代币之下，是一个由1000多台不受信任的计算机操作的分布式平台。但是，1台计算机怎么能存在于1000台计算机之上呢？

你了解PoW和PoS的真正运作方式吗？

 
以太坊是世界计算机，一个全球共享的平台，存在于1000多台电脑的网络之间，每台电脑都运行着以太坊虚拟机（EVM）的本地副本。

每个本地EVM都是同步的；任何节点的状态就是世界计算机的状态。

世界计算机以被称为区块（包含EVM内的交易，或actions）的单位进行。一个区块生产者将创建一个区块并将其发送到网络上。

当节点收到新的区块时，他们会将其送入他们的EVM副本中，将其同步到leader那里。

选择提案人(proposer)和决定区块的系统被称为共识。

在其生命的前7年里， 以太坊使用工作证明（PoW）作为一种共识机制。但从2022年9月中旬开始，世界计算机已经过渡到了权益证明（PoS）。

PoW的发明是为了比特币，由中本聪在2008年发明。PoW是基于令人难以置信的数学难题；每个节点创建一个新的区块，并竞相完成这些难题之一。

第一个解开谜题的人提出他们的区块（包括解决方案）。

其余的节点会验证该区块和难题。如果两者都是有效的，他们会丢弃自己的区块，并将新的区块添加到他们的本地EVM中。然后，他们开始制作一个新的区块。

每个新的区块都会确认之前的区块 接受是对经典链(cononical chain)的隐性投票。

这些 "难以置信的数学难题 "是PoW的基石。解决它们的唯一方法是运行许多强大的机器（并花费大量的电力）。

这项工作提供了重力，使每张隐含的投票都有如此大的分量。

PoS用一个更直接的系统取代了这些难题：区块提议者(block proposer)只需轮流。

- 一个validator被随机选择成为区块提议者。
- 区块提议者向网络广播一个区块
- 网络验证该区块

这个系统本身并不安全；它用信任取代了PoW的现实世界工作/电力的基础。

相信每个提议者（proposer）会提出有效的区块，相信网络会诚实地验证(verify)，相信最佳的网络条件......如此多的信任。（PoS本身相对PoW更加中心化）

因此，我们引入了股权(stake)：每个validator的资本贡献，作为参与和诚实参与的保证。

为了成为一个ethereum的validator，运营商必须首先在存款合约中锁定32个ETH，使其有资格被惩罚扣除(slashing)。

削减(slashing)是一个两部分的过程。

- 通过消耗validator的股权stake（在最糟糕的情况下可达到整个32个ETH）对不良行为进行经济惩罚
- 强行将违规者从网络/validators集合中剔除

[A Staker's Guide to Ethereum Slashing & Other Penalties (blocknative.com)](https://www.blocknative.com/blog/an-ethereum-stakers-guide-to-slashing-other-penalties)

slashing是一种非常罕见的情况，只有在恶意节点攻击网络时才会发生（或极端的操作错误）。

尽管如此，slashing是PoS的主要执行机制和安全来源。

仅仅是slashing并不足以保证我们简单的PoS系统。

PoW的一个核心动力和它的谜题的难以置信的难度是对典范链(cononical chain)的隐性投票。创造一个新区块是非常困难的；创造两个（更不用说更多）是新的不可能。

攻击链需要克服现实世界的制约因素。

投票是隐性的，因为它实际上并不存在，它只是我们用来从网络的角度描述区块链的一个比喻。

在PoS中，我们必须用明确的投票取代隐性的投票。就像PoW一样，每个区块都会收到一份其区块的副本，但在PoS中，一个子集也会对每个区块的有效性进行显性投票。

这些validators中的每一个人都在亲自投票决定一个区块是否有效。

投票被称为证明(attestation)。通过签署证明（signing an attestation），validator将他们的股权stake置于风险之中：如果区块最终是无效的，他们也将被砍掉(slashed)。

就这样，以太坊的安全，不仅对提议者(block proposers)的股份stake有保障，而且对每个证明者(attesters)的股份stake也有保障。

以太坊看待时间的方式与我们不同。

时间单位被分割成若干个slots，每个slot（应该）包含一个区块。32个slots相当于一个epoch，也就是6.4分钟。

在PoS下，每个Ethereum validator将在每个epoch投票（attest或propose）一次。[[ETH之时间-Slots和Epochs]]

因此，每6.4分钟一次epoch，整个validators集合将在经典区块链(cononical blockchain)上投票，并将其全部股权stake放在线(the line)上进行slashing。

每个epoch一次。以太坊的安全就会被所有被押注的ETH代币的总价值所保障。

今天，这是约190亿美元。

![[Pasted image 20221009142859.png]]

在我们的PoS系统能够取代PoW之前，我们还需要对它进行最后一个更细微的修改。

PoW永远不会有锁死的风险。只要有一个节点存在，它就能解决谜题，并在链上取得进展（尽管解决的时间会很长）。

> 这里的进展的意思就是共识不会停止，链的高度区块一直会增长，所以以前我们的FnFn区块链是混合共识，DPoS + PoW，PoW就是为了暂时顶替极端情况下，DPoS/PoS不出块的算法。这就是一些区块链分布式共识算法里面经常提到的liveness，也就是共识的活性。

PoS来自数学传统，源于拜占庭将军问题。

简而言之，共识要求网络中的节点之间至少有2/3的人同意。

如果大于1/3的人不在线会怎样？那么请看 [[拜占庭容错和其实战性PBFT解决方案]]

以太坊有一个双线防御方法。

首先，未能履行职责的validator（例如遗漏/延迟/错误的attestation证明）会受到轻微的惩罚(penalty)。这是对保持在线的一种鼓励，但在日常维护或网络波动期间，每个人都会感受到。

如果大于2/3的网络没有参与。以太坊不能最终确定。当这种情况变得足够可怕时，网络会激活它的第二道防线：不活动泄漏(inactivity leak)。

不活动泄漏(inactivity leak)是一种遵循规则的紧急状态，直到2/3的人可以达到。

![[Pasted image 20221009143607.png]]
 这两种防御措施都明显比slashing要轻。不仅经济上的惩罚要少得多，validator不会被逐出网络。

一般来说，这些惩罚可以用大致相同的时间赚回来。

综上所述，我们现在有了一个安全的PoS系统!

我就不多说了，就说说其中的利弊吧（引自以太坊网站）。

![[Pasted image 20221009143726.png]]

