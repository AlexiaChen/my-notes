
阈值签名方案（TSS）是一种用于分布式密钥生成和签名的加密原语。在区块链客户端中使用TSS是一种新的范例，可以提供许多好处，特别是在安全方面。在更广泛的意义上，TSS可以影响密钥管理系统（如加密钱包 [What Is a Crypto Wallet? | Binance Academy](https://academy.binance.com/en/articles/crypto-wallet-types-explained) ）的设计，并引领DeFi用例的本地支持。话虽如此，TSS仍然是一项新技术，因此还应考虑风险和限制。

在本文中，我们将介绍TSS是什么，它为区块链领域带来了哪些潜在优势，如何在区块链客户端中实现它，它如何与Shamir Secret sharing和多重签名（MultiSig）[What Is a Multisig Wallet? | Binance Academy](https://academy.binance.com/en/articles/what-is-a-multisig-wallet) 进行比较，使用TSS进行分布式密钥管理的不同方式，以及最后我们讨论风险和限制。

### 密码学的威力

为了理解TSS，我们首先需要一些基本的密码学知识。自20世纪70年代以来，越来越多的互联网系统（如TLS和PGP [What Is PGP? | Binance Academy](https://academy.binance.com/en/articles/what-is-pgp) ）采用了非对称密码学，也称为公钥密码学（PKC [What is Public Key Cryptography? | Binance Academy](https://academy.binance.com/en/articles/what-is-public-key-cryptography) ）。PKC利用两个密钥：一个公钥和一个私钥。虽然公钥不是秘密，可以被任何人发布和使用，但私钥是一段表示系统安全的秘密信息。

加密和数字签名是PKC的两种最常见用途。加密和数字签名方案都依赖于三个算法集合。第一个是私钥和公钥对的生成，第二个是密文/签名的生成，第三个是解密/验证的过程。关于数字签名，签名算法需要私钥（仅由其所有者知道）才能产生唯一的签名。签名以一种方式附加到给定的消息上，以便任何持有公钥的人都能够验证其真实性和正确性。

### 区块链

毫无疑问，区块链是一项非常强大的技术。它提供了一个共识层，组织和记录事件。这样的基础设施赋予我们，用户，建立去中心化经济甚至政府的潜在力量。令人惊讶的是，运行基本区块链所需的密码学可以仅基于数字签名。在区块链的背景下，私钥代表身份，而签名是身份发出的公共声明或声明。区块链将根据一组规则对这些声明进行排序和验证，这些规则确保签名是不可伪造和正确的。

与区块链中使用的更经典的密码学相比，现代密码学工具箱包括一些令人惊叹的魔术技巧：零知识证明、同态加密和多方计算等。正如我们在过去十年中所看到的，区块链研究极大地推动了应用密码学的发展，最近在上述所有领域和更多领域取得了重大突破。

在本文中，我们将重点关注一项这样的突破：高效安全的阈值签名（TSS）。

### MPC和门限签名方案

多方计算（MPC）是密码学的一个分支，始于近40年前Andrew C. Yao的开创性工作。在MPC中，一组不信任彼此的参与者尝试在保持这些输入私有的同时共同计算其输入的函数。

例如，假设一家公司的n名员工想知道谁的薪水最高，但不想向彼此透露他们的实际薪水。在这里，私人输入是薪水，输出将是获得最高薪水的员工姓名。使用MPC进行此计算，我们得到在计算过程中甚至没有一个薪水泄露的结果。

MPC的两个主要属性是正确性和隐私：

- 正确性：算法产生的输出是正确的（符合预期）。

- 隐私：一个参与方持有的秘密输入数据不会泄露给其他参与方。

我们将使用MPC以分布式方式计算数字签名。让我们看看如何将上述属性应用于签名。回想一下，对于签名，我们有三个步骤：

- 密钥生成：第一步也是最复杂的步骤。我们需要生成一个公钥，用于验证未来的签名。但是，我们还需要为每个参与方生成一个单独的秘密，我们将其称为秘密份额。在正确性和隐私方面，我们说该函数将输出相同的公钥给所有参与方，并为每个参与方生成不同的秘密份额(secret share)，使得：（1）隐私：没有秘密份额数据在参与方之间泄露，（2）正确性：公钥是秘密份额的函数。

- 签名：此步骤涉及签名生成函数。每个参与方的输入将是其作为前一步（分布式密钥生成DKG）的输出的秘密份额。所有人都知道的还有公共输入，即要签名的消息。输出将是数字签名，隐私属性确保在计算过程中没有秘密份额泄露。

- 验证：验证算法与经典设置中保持不变。为了与单个密钥签名兼容，每个具有公钥知识的人都应该能够验证和验证签名。这正是区块链验证节点所做的。

阈值签名方案（TSS）是我们给这种分布式密钥生成（DKG）和分布式签名组成的名称。

### TSS与区块链结合

阈值签名方案可以通过更改区块链客户端以使用TSS来自然地应用于区块链。在这里，我们使用术语“区块链客户端”来指代由完整节点执行的命令集。实际上，TSS技术允许我们用分布式计算替换所有与私钥相关的命令。

为了更详细地解释，我们首先简要描述一下传统区块链设计中如何创建新地址。简单来说，我们可以通过生成私钥，然后从私钥计算公钥来创建新地址。最后，区块链地址是从公钥派生出来的。

现在，使用TSS，我们将有一组n个参与方共同计算公钥，每个参与方持有私钥的一个秘密份额（各自的份额不会透露给其他参与方）。从公钥中，我们可以以与传统系统相同的方式派生地址，使得区块链对地址生成方式不可知。优点是私钥不再是单点故障，因为每个参与方只持有其中的一部分。

在签署交易时也可以做到同样的事情。在这种情况下，我们不是单个参与方使用其私钥进行签名，而是在多个参与方之间运行分布式签名生成。因此，只要有足够多的参与方诚实地行事，每个参与方都可以产生有效的签名。再次从本地计算（单点故障）转移到交互式计算。

值得一提的是，分布式密钥生成可以以允许不同类型的访问结构的方式进行，一般的“t out of n”设置将能够经受住在私钥相关操作中最多t个任意故障，而不会影响安全性。

### TSS与多重签名(多签)

一些区块链在软件中提供TSS功能作为内置或可编程部分。我们称这种功能为多重签名（multisig）。为了更好地理解区别，我们可以将多重签名视为区块链应用层中的TSS。

换句话说，多重签名和TSS本质上都试图实现类似的目标，但TSS在链下使用密码学，而多重签名在链上进行。然而，区块链需要一种编码多重签名的方式，这可能会损害隐私，因为访问结构（签名者数量）在区块链上公开。多重签名交易的成本更高，因为不同签名者的信息也需要在区块链上进行通信。

在TSS中，签名者的详细信息被折叠到一个常规的交易中，降低了成本并保持了隐私。另一方面，多重签名可以是非交互式的，这可以避免在不同签名者之间运行复杂的通信层所带来的麻烦。

主要的区别是多重签名是针对特定区块链的，需要为每个区块链重新实现，有时根本不受支持。相反，TSS依赖于纯密码学，因此始终可以得到支持。这里有一篇带有插图的很好的文章，介绍了它们之间的区别。[Threshold Signatures: The Future of Private Keys | by Tal Be'ery | ZenGo | Medium](https://medium.com/zengo/threshold-signatures-private-key-the-next-generation-f27b30793b)

### TSS与Shamir Secret Sharing方案

Shamir秘密共享方案（SSSS）提供了一种以分布方式存储私钥的方法，使得在私钥处于静止状态时，它被存储在多个位置。SSSS和TSS之间有两个区别：

密钥生成：在SSSS中，有一个称为“dealer”（发牌者）的单个参与方负责生成私钥秘密份额（其实就是多项式的P(0)值）。这意味着在密钥生成时，私钥在单个位置生成，然后由dealer分发到不同的位置。在TSS中，没有dealer，因为其角色是分布式的，因此完整的私钥从未在单个位置。

签名：在SSSS中，参与方必须重构完整的私钥才能签名（这样私钥又出现了一次），这又导致每次需要签名时都会出现单点故障。在TSS中，签名是以分布式方式完成的，而不需要重构秘密份额为私钥。

正如我们所看到的，在TSS中，私钥（代表系统的安全性）在其整个生命周期中从未在单个位置。

### 门限钱包


基于TSS技术的钱包与传统的加密货币钱包有所不同。通常，传统钱包生成种子短语，并使用它来确定性地推导地址。用户可以稍后使用这种分层确定性（HD）结构来

- 1）到达对应于钱包地址的私钥并使用它们签署交易，以及
- 2）使用种子短语恢复所有钱包密钥。

在阈值钱包中，情况更加复杂。虽然可以生成HD结构，但必须以另一个MPC协议的方式进行分布式计算。参与方需要共同决定下一个要使用的密钥。换句话说，每个参与方都有自己的种子短语。种子短语是分别生成的，从未合并，因此单个参与方无法从其种子中推导出私钥。

基于TSS的钱包还具有一个很好的安全功能，即使私钥轮换时不更改相应的公钥和区块链地址。私钥轮换，也称为主动秘密共享(proactive secret sharing)，是另一个MPC协议，它以秘密份额作为输入，并输出一组新的秘密份额。旧的秘密份额可以被删除，新的秘密份额可以以相同的方式使用。

这样的结构为安全性添加了一个时间维度，这意味着攻击者必须同时处于多个位置才能攻击阈值钱包。如果攻击者想要伪造签名，将轮换前后的秘密份额组合也不会给他们带来额外的能力。

这种类型的钱包的一个缺点是缺乏种子短语，使其与单密钥钱包系统不兼容。因此，重要的是考虑哪些参与方将持有秘密份额。

有几种可能的架构：

- 外包TSS（outsourcing TSS）：用户将让“n”个服务器代表他们运行计算。实际上，将密钥生成、管理和签名外包给不是资产所有者但提供安全层的服务提供商，以换取一些激励。

- 使用多个设备：用户将在自己拥有的设备之间运行TSS。例如，一个参与方将是某个物联网设备，另一个参与方将是用户手机，另一个参与方将是他们的笔记本电脑，等等。

- 混合：TSS将运行，以使一些参与方由外部服务提供商控制，一些参与方在用户拥有的设备上运行。

第一种方法将TSS的重计算从用户客户端端卸载。另一方面，服务提供商可能会勾结（我们假设足够多的服务提供商不会同时受到攻击，但在实践中，他们可能会）并窃取用户的资产。

第二种方法给用户完全的控制，但使进行交易变得麻烦，因为需要多个设备在线并参与TSS计算。

第三个选项被认为是两全其美的选择，因为它为用户提供了一种简单快捷的进行交易的方式，同时又不会妥协于没有用户授权的交易。

### TSS和智能合约

多年来，研究人员发现数字签名有许多用途，其中一些用途非常复杂。如上所述，TSS是一种可以极大增加安全性的密码学原语。在区块链的背景下，我们可以说许多功能可以用基于TSS的密码学来替代。Dapp、第2层扩展解决方案、原子交换 [Atomic Swaps Explained | Binance Academy](https://academy.binance.com/en/articles/atomic-swaps-explained) 、混合、继承等等都可以建立在TSS框架之上。这最终将允许昂贵和风险高的链上智能合约操作被更便宜和更可靠的替代品所取代。

举几个具体的例子：Multi-Hop Locks [ZenGo-X/multi-hop-locks: ECDSA based construction for Anonymous Multi-Hop Locks (https://eprint.iacr.org/2018/472.pdf) (github.com)](https://github.com/ZenGo-X/multi-hop-locks) 巧妙地利用了双方签名，并可以用作比比特币闪电网络更安全和更私密的支付通道网络的替代品。ShareLock [ZenGo-X/ShareLock: ShareLock: mixing for cryptocurrencies from multiparty ECDSA (github.com)](https://github.com/ZenGo-X/ShareLock) 可能是以太坊上最便宜的链上混合解决方案，基于单个门限签名的验证。

### 风险

在过去的几年中，TSS实现数量显著增加。然而，作为一种相对较新的技术，它仍然存在一些限制和问题。与经典的公钥密码学相比，TSS协议可能非常复杂，并且尚未经过“实战测试”。通常，与简单的数字签名相比，TSS需要更弱的密码学假设。因此，现在正在发现一些在传统设置中不存在的密码攻击向量（请参见Breaking Bitcoin Conference 2019的此演示文稿 [breaking_bitcoin19_updated (zengo.com)](https://zengo.com/wp-content/uploads/2019/06/breaking_bitcoin19_updated.pdf) ）。安全工程师和应用密码学家可以协助您在系统中安全地部署TSS。

从积极的方面来看，由于质量贡献、同行评审、审计和算法性能改进的增加，现有和新的实现正在变得更加强大。

### 结束语

在本文中，我们介绍了门限签名方案（TSS）的基础知识，这是一种迷人的密码学原语，有潜力显著改变我们使用区块链的方式。

由于本文没有讨论门限ECDSA，而这可以在Binance Chain和比特币中使用，有兴趣的读者可以参考以下最近的论文列表。此外，如果您想尝试一些TSS实现，可以在此处找到用于双方Binance Chain钱包的代码[ZenGo-X/binance-thresh-wallet: Wallet for Binance chain powered by two-party ECDSA (github.com)](https://github.com/ZenGo-X/binance-thresh-wallet) ，或尝试ZenGo钱包，该钱包利用混合方法提供非托管的双方Binance Chain钱包。


[Fast Secure Two-Party ECDSA Signing (iacr.org)](https://eprint.iacr.org/2017/552)

[987.pdf (iacr.org)](https://eprint.iacr.org/2018/987.pdf)

[503.pdf (iacr.org)](https://eprint.iacr.org/2019/503.pdf)

[114.pdf (iacr.org)](https://eprint.iacr.org/2019/114.pdf)

[499.pdf (iacr.org)](https://eprint.iacr.org/2018/499.pdf)

[523.pdf (iacr.org)](https://eprint.iacr.org/2019/523.pdf)

