## 工作笔记


## GB28181

[技术解码 | GB28181协议简介及实践 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/393863592)

![[Pasted image 20220726174002.png]]
![[Pasted image 20220726174017.png]]

[swwheihei/wvp-GB28181: WEB VIDEO PLATFORM是一个基于GB28181-2016标准实现的网络视频平台，负责实现核心信令与设备管理后台部分，支持NAT穿透，支持海康、大华、宇视等品牌的IPC、NVR、DVR接入。 流媒体服务基于ZLMediaKit-https://github.com/xiongziliang/ZLMediaKit 前端展示基于MediaServerUI-https://gitee.com/kkkkk5G/MediaServerUI/tree/gb28181/](https://github.com/swwheihei/wvp-GB28181)


GB28181一般要求推送PS流（PS是一种容器封装格式，与mp4 flv 等是同层次的概念，以.m2p .ps结尾），用RTP/RTCP传输。好像不是RTMP
[Difference Between MPEG-PS and MPEG-TS Explained Simply and Clearly (freevideoworkshop.com)](https://www.freevideoworkshop.com/difference-between-mpeg-ps-and-mpeg-ts/)

[MPEG program stream - Wikipedia](https://en.wikipedia.org/wiki/MPEG_program_stream)

[GB28181-Server: LiveGBS国标(GB28181)流媒体服务软件前端源码 (gitee.com)](https://gitee.com/livegbs/GB28181-Server)

[GB28181-Server/web_src at master · livegbs/GB28181-Server (github.com)](https://github.com/livegbs/GB28181-Server/tree/master/web_src)
[GB28181推流 · ZLMediaKit/ZLMediaKit Wiki (github.com)](https://github.com/ZLMediaKit/ZLMediaKit/wiki/GB28181%E6%8E%A8%E6%B5%81)

GB28181的某些实现中也是，如果同一个会话中RTP中的ssrc变化，会丢弃RTP的包
[(4条消息) RTP中SSRC_sunxiaopengsun的博客-CSDN博客_rtp ssrc](https://blog.csdn.net/sunxiaopengsun/article/details/70172090)

ZLMediaKit的运行问题已经解决
[[疑难解答] RTSP 端口554 bind 失败 · Issue #1833 · ZLMediaKit/ZLMediaKit (github.com)](https://github.com/ZLMediaKit/ZLMediaKit/issues/1833)



### RTP的PS封装

因为GB28181的推流是基于RTP的PS封装（也可以不是PS封装，比如可以直接是RTP封装MPEG-4,H.264, SVAC），所以需要了解其PS格式。

基于RTP的PS封装首先安装ISO/IEC 13818-1:2000 将音视频流封装成PS包，再将PS包封装成RTP包

进行PS封装时，应将每个视频帧封装成一个PS包，且每个关键帧的PS包中应包含系统头(System Header)和PSM(Program Stream Map)，系统头和PSM放置于PS包头后，第一个PES包之前。典型的视频关键帧PS包结构如下图，其中PESV为视频PES包，PESA为音频PES包，视频非关键帧的PS包不包含System Header和PSM。


![[7d6243a1d93bf372d9227309f2fd43e.png]]

还有PS包中的一些参数取值如下:

![[58003eca9f628ffe4dc3382281a5bfc.png]]

## RTP的音视频基本封装

该方式直接将视音频数据以负载的方式封装成 RTP包。

![[d3a367501f7ea610499383bf7200b0f.png]]

![[920217d7bd46816e69131088fea92cd.png]]

![[84af40bef47e1d1220c30330e8f0114.png]]



## RTMP & FFmpeg

[Stream MP4 video successfully to RTMP with FFMPEG - Stack Overflow](https://stackoverflow.com/questions/33883405/stream-mp4-video-successfully-to-rtmp-with-ffmpeg)


[StreamingGuide – FFmpeg](https://trac.ffmpeg.org/wiki/StreamingGuide)


## OpenCV 摄像头 & 推流

 [C++ OpenCV 顯示camera攝影機串流影像 | ShengYu Talk (shengyu7697.github.io)](https://shengyu7697.github.io/opencv-camera/)
 [How to capture video from other cameras in OpenCV using C++? (tutorialspoint.com)](https://www.tutorialspoint.com/how-to-capture-video-from-other-cameras-in-opencv-using-cplusplus)

[How to capture video from default camera in OpenCV using C++? (tutorialspoint.com)](https://www.tutorialspoint.com/how-to-capture-video-from-default-camera-in-opencv-using-cplusplus)

[Play Video from File or Camera - OpenCV Tutorial C++ (opencv-srf.com)](https://www.opencv-srf.com/2017/12/play-video-from-file-or-camera.html)

[Opencv tutorial RTMP video streaming to NGINX restream as HLS (funvision.blogspot.com)](https://funvision.blogspot.com/2022/02/video-streaming-for-machine-learning.html)

[Multimedia: Which is better: FFmpeg or GStreamer? Why? - Quora](https://www.quora.com/Multimedia-Which-is-better-FFmpeg-or-GStreamer-Why)

[streaming - How to stream via RTMP using Gstreamer? - Stack Overflow](https://stackoverflow.com/questions/41550901/how-to-stream-via-rtmp-using-gstreamer)

[python 3.x - How to output x265 compressed video with cv2.VideoWriter - Stack Overflow](https://stackoverflow.com/questions/61260182/how-to-output-x265-compressed-video-with-cv2-videowriter/61281547#61281547)

[Pipe and OpenCV to FFmpeg with audio streaming RTMP in Python - Stack Overflow](https://stackoverflow.com/questions/70471732/pipe-and-opencv-to-ffmpeg-with-audio-streaming-rtmp-in-python/70476737#70476737)

[jkuri/opencv-ffmpeg-rtmp-stream: OpenCV FFMpeg Live Video Stream over RTMP protocol. (github.com)](https://github.com/jkuri/opencv-ffmpeg-rtmp-stream)



