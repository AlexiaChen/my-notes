# 系统设计

## 分布式任务调度器

[System Design — Design a distributed job scheduler (KISS Interview series) | by Rakshesh Shah | May, 2022 | Medium](https://medium.com/@raxshah/system-design-design-a-distributed-job-scheduler-kiss-interview-series-753107c0104c)

## 事件驱动架构

[AWS Lambda Best Practices and Event-driven Architecture | by Mehmet Ozkaya | AWS Serverless Microservices with Patterns & Best Practices | Medium](https://medium.com/aws-serverless-microservices-with-patterns-best/aws-lambda-best-practices-and-event-driven-architecture-d6b897d9c96e)

[NoSQL, NoMQ: Palo Alto Networks’ New Event Streaming Paradigm – The New Stack](https://thenewstack.io/nosql-nomq-palo-alto-networks-new-event-streaming-paradigm)

## 领域驱动(DDD)

[Practical DDD, Part 1 — Setting The Right Foundations | by Hila Fox | Machines talk, we tech. | Medium](https://medium.com/augury-research-and-development/practical-ddd-part-1-setting-the-right-foundations-5b7e4b16c9e8)

[Practical DDD — Transforming Theories into Guidelines | by Hila Fox | Machines talk, we tech. | May, 2022 | Medium](https://medium.com/augury-research-and-development/practical-ddd-transforming-theories-into-guidelines-75b2daf9b8d)

[Ports & Adapters Architecture – @hgraca (herbertograca.com)](https://herbertograca.com/2017/09/14/ports-adapters-architecture/)



## 日志系统



## 软件工程

[Software Engineering at Google (abseil.io)](https://abseil.io/resources/swe-book/html/toc.html)

![[Pasted image 20220706215802.png]]


[44 engineering management lessons | defmacro](https://www.defmacro.org/2014/10/03/engman.html)

## 消息通知系统设计

How are notifications pushed to our phones or PCs? 
A messaging solution (Firebase) can be used to support the notification push. The diagram below shows how Firebase Cloud Messaging (FCM) works.

![[Pasted image 20220711094508.png]]


FCM is a cross-platform messaging solution that can compose, send, queue, and route notifications reliably. It provides a unified API between message senders (app servers) and receivers (client apps). The app developer can use this solution to drive user retention.

Steps 1 - 2: When the client app starts for the first time, the client app sends credentials to FCM, including Sender ID, API Key, and App ID. FCM generates Registration Token for the client app instance (so the Registration Token is also called Instance ID).

This token must be included in the notifications. Step 3: The client app sends the Registration Token to the app server. The app server caches the token for subsequent communications.

Over time, the app server has too many tokens to maintain, so the recommended practice is to store the token with timestamps and to remove stale tokens from time to time.

Step 4: There are two ways to send messages. One is to compose messages directly in the console GUI (Step 4.1,) and the other is to send the messages from the app server (Step 4.2.) We can use the Firebase Admin SDK or HTTP for the latter.

Step 5: FCM receives the messages, and queues the messages in the storage if the devices are not online.

Step 6: FCM forwards the messages to platform-level transport. This transport layer handles platform-specific configurations.

Step 7: The messages are routed to the targeted devices. The notifications can be displayed according to the configurations sent from the app server

## 密码存储在DB中的设计

![[Pasted image 20220711095009.png]]

Storing passwords in plain text is not a good idea because anyone with internal access can see them.  Storing password hashes directly is insufficient because it is pruned to precomputation attacks, such as rainbow tables. To mitigate this, we salt the passwords.

𝐖𝐡𝐚𝐭 𝐢𝐬 𝐬𝐚𝐥𝐭? According to OWASP guidelines, “a salt is a unique, randomly generated string that is added to each password as part of the hashing process”.

𝐇𝐨𝐰 𝐭𝐨 𝐬𝐭𝐨𝐫𝐞 𝐚 𝐩𝐚𝐬𝐬𝐰𝐨𝐫𝐝 𝐚𝐧𝐝 𝐬𝐚𝐥𝐭?  
- A salt is not meant to be secret and it can be stored in plain text in the database. It is used to ensure the hash result is unique to each password.
- The password can be stored in the database using the following format: 𝘩𝘢𝘴𝘩( 𝘱𝘢𝘴𝘴𝘸𝘰𝘳𝘥 + 𝘴𝘢𝘭𝘵).

𝐇𝐨𝐰 𝐭𝐨 𝐯𝐚𝐥𝐢𝐝𝐚𝐭𝐞 𝐚 𝐩𝐚𝐬𝐬𝐰𝐨𝐫𝐝? To validate a password, it can go through the following process:
- A client enters the password.
- The system fetches the corresponding salt from the database.
- The system appends the salt to the password and hashes it. Let’s call the hashed value H1.
- The system compares H1 and H2, where H2 is the hash stored in the database. If they are the same, the password is valid.


#### 实时视频流系统的架构

1. How do video live streamings work on YouTube, TikTok live, or Twitch? The technique is called live streaming. Livestreaming differs from regular streaming because the video content is sent via the internet in real-time, usually with a latency of just a few seconds.

![[Pasted image 20220812112757.png]]

2. The diagram below explains what happens behind the scenes to make this possible. 

- Step 1: The raw video data is captured by a microphone and camera. The data is sent to the server side.
- Step 2: The video data is compressed and encoded. For example, the compressing algorithm separates the background and other video elements. After compression, the video is encoded to standards such as H.264. The size of the video data is much smaller after this step.
- Step 3: The encoded data is divided into smaller segments, usually seconds in length, so it takes much less time to download or stream.
- Step 4: The segmented data is sent to the streaming server. The streaming server needs to support different devices and network conditions. This is called ‘Adaptive Bitrate Streaming.’ This means we need to produce multiple files at different bitrates in steps 2 and 3.
- Step 5: The livestreaming data is pushed to edge servers supported by CDN (Content Delivery Network.) Millions of viewers can watch the video from an edge server nearby. CDN significantly lowers data transmission latency.
- Step 6: The viewers’ devices decode and decompress the video data and play the video in a video player. 
- Steps 7 and 8: If the video needs to be stored for replay, the encoded data is sent to a storage server, and viewers can request a replay from it later.


3. Common protocols for live streaming include: 
- RTMP (Real-Time Messaging Protocol): This was originally developed by Macromedia to transmit data between a Flash player and a server. Now it is used for streaming video data over the internet.

4. Note that video conferencing applications like Skype use RTC protocol for low latency 
- HLS (HTTP Live Streaming): It requires the H.264 or H.265 encoding. Apple devices accept only HLS format 
- DASH (Dynamic Adaptive Streaming over HTTP): DASH does not support Apple devices

5. Both HLS and DASH support adaptive bitrate streaming.


#### 基本JWT Auth流程设计

![[Pasted image 20220827214210.png]]

#### Netflix消息推送到设备的系统设计

![[Pasted image 20220827221017.png]]

𝐑𝐞𝐪𝐮𝐢𝐫𝐞𝐦𝐞𝐧𝐭𝐬 & 𝐬𝐜𝐚𝐥𝐞 
- 220 million users 
- Near real-time 
- Backend systems need to send notifications to various clients 
- Supported clients: iOS, Android, smart TVs, Roku, Amazon FireStick, web browser

1. Push notification events are triggered by the clock, user actions, or by systems. 
2. Events are sent to the event management engine.
3. The event management engine listens to specific events and forward events to different queues. The queues are populated by priority-based event forwarding rules
4. The “event priority-based processing cluster” processes events and generates push notifications data for devices
5. A Cassandra database is used to store the notification data.
6. A push notification is sent to outbound messaging systems.
7. For Android, FCM is used to send push notifications. For Apple devices, APNs are used. For web, TV, and other streaming devices, Netflix’s homegrown solution called ‘Zuul Push’ is used.

[Rapid Event Notification System at Netflix | by Netflix Technology Blog | Netflix TechBlog](https://netflixtechblog.com/rapid-event-notification-system-at-netflix-6deb1d2b57d1)



#### CORS跨域

![[Pasted image 20220907142317.png]]

